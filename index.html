<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VALORANT // PROTOCOL</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:ital,wght@0,400;0,600;0,900;1,900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --val-red: #ff4655;
            --val-dark: #0f1923;
            --val-black: #000000;
            --val-white: #ece8e1;
            --val-green: #22c55e;
        }

        body {
            background-color: var(--val-dark);
            color: var(--val-white);
            font-family: 'Kanit', sans-serif;
            overflow: hidden;
            touch-action: none;
            user-select: none;
            cursor: crosshair;
        }

        /* --- TACTICAL BACKGROUND --- */
        .bg-tactical {
            background-color: #0f1923;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.02) 1px, transparent 1px),
                radial-gradient(circle at 50% 50%, rgba(20, 30, 45, 0) 0%, rgba(0, 0, 0, 0.6) 100%);
            background-size: 50px 50px, 50px 50px, 100% 100%;
        }

        /* --- THE CRATE (PLAYER) --- */
        #player-crate {
            position: absolute;
            bottom: 20px;
            width: 140px; 
            height: 140px;
            transform: translateX(-50%);
            z-index: 20;
            pointer-events: none;
            transition: transform 0.05s ease-out;
            will-change: transform;
            display: flex;
            align-items: flex-end;
            justify-content: center;
        }

        #player-crate img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 10px 10px rgba(0,0,0,0.5));
        }

        /* --- FALLING ITEMS --- */
        .skin-object {
            position: absolute;
            width: 130px;
            height: 70px;
            z-index: 10;
            will-change: transform;
            top: -100px; 
        }

        .skin-object img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3));
        }

        /* --- UI ELEMENTS --- */
        .val-header {
            text-shadow: 0 4px 0 rgba(0,0,0,0.5);
            letter-spacing: 0.1em;
        }

        /* --- ANIMATIONS --- */
        @keyframes catch-pop {
            0% { transform: scale(1); filter: brightness(1); }
            50% { transform: scale(1.2); filter: brightness(1.5); }
            100% { transform: scale(1); filter: brightness(1); }
        }
        .pop-anim { animation: catch-pop 0.15s ease-out; }

        /* --- LOADER --- */
        #loader {
            position: fixed;
            inset: 0;
            background: #0f1923;
            z-index: 999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .loader-bar {
            width: 200px;
            height: 4px;
            background: #333;
            margin-top: 20px;
            position: relative;
            overflow: hidden;
        }
        .loader-progress {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            background: var(--val-red);
            width: 0%;
            transition: width 0.2s;
        }

        /* --- UPLOAD SEQUENCE UI --- */
        .upload-track {
            width: 100%;
            height: 8px;
            background: #333;
            margin-top: 10px;
            position: relative;
        }
        .upload-fill {
            height: 100%;
            background: var(--val-red);
            width: 0%;
            transition: width 0.1s linear;
        }
        
        /* Success Checkbox */
        .success-box {
            width: 80px;
            height: 80px;
            background: var(--val-green);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            box-shadow: 0 0 20px rgba(34, 197, 94, 0.4);
            transform: scale(0);
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .success-box.active {
            transform: scale(1);
        }
        .checkmark {
            color: #0f1923;
            font-size: 40px;
            font-weight: 900;
        }

    </style>
</head>
<body class="h-screen w-screen bg-tactical">

    <!-- LOADING SCREEN -->
    <div id="loader">
        <h1 class="text-4xl font-black italic text-white uppercase tracking-widest"></h1>
        <div class="loader-bar">
            <div id="loader-progress" class="loader-progress"></div>
        </div>
        <p id="loader-text" class="text-xs text-gray-500 mt-2 font-mono">INITIALIZING PROTOCOL...</p>
        <button id="btn-start" class="hidden mt-8 px-10 py-3 bg-[#ff4655] hover:bg-red-600 text-white font-black text-xl uppercase tracking-widest clip-path-polygon transition-all" onclick="startGame()">
            ENTER RANGE
        </button>
    </div>

    <!-- HUD -->
    <div class="absolute top-0 w-full p-4 flex justify-between items-start z-50 pointer-events-none select-none">
        <div class="flex flex-col">
            <h1 class="val-header text-5xl font-black italic uppercase text-white leading-none">
                SKIN <span class="text-[#ff4655]">DROP</span>
            </h1>
            <div class="flex items-center gap-2 mt-1">
                <div class="h-2 w-2 bg-[#ff4655]"></div>
                <span class="text-xs font-bold tracking-[0.2em] text-gray-400 uppercase">System Active // Target: 3</span>
            </div>
        </div>
        <div class="flex flex-col items-end">
            <div id="inventory-grid" class="grid grid-cols-1 gap-1"></div>
        </div>
    </div>

    <!-- FX -->
    <div id="fx-layer" class="absolute inset-0 pointer-events-none z-30 flex items-center justify-center opacity-0 transition-opacity duration-100">
        <div class="w-full h-full border-4 border-[#ff4655] animate-pulse"></div>
    </div>

    <!-- GAME AREA -->
    <div id="game-container" class="absolute inset-0 overflow-hidden z-10"></div>

    <!-- PLAYER -->
    <div id="player-crate">
        <img src="https://i.ibb.co/8gp7yYmP/image-removebg-preview.png" alt="Crate" draggable="false">
    </div>

    <!-- WIN/UPLOAD MODAL -->
    <div id="modal" class="fixed inset-0 z-[100] bg-black/95 hidden flex items-center justify-center backdrop-blur-md">
        <div class="relative w-full max-w-2xl p-1 bg-[#0f1923] border border-white/10">
            <!-- Decorative Corners -->
            <div class="absolute top-0 left-0 w-4 h-4 border-t-2 border-l-2 border-[#ff4655]"></div>
            <div class="absolute top-0 right-0 w-4 h-4 border-t-2 border-r-2 border-[#ff4655]"></div>
            <div class="absolute bottom-0 left-0 w-4 h-4 border-b-2 border-l-2 border-[#ff4655]"></div>
            <div class="absolute bottom-0 right-0 w-4 h-4 border-b-2 border-r-2 border-[#ff4655]"></div>

            <div class="p-8 flex flex-col items-center text-center">
                
                <!-- STAGE 1: CONFIRMATION -->
                <div id="stage-confirm" class="w-full flex flex-col items-center transition-opacity duration-500">
                    <div class="bg-[#ff4655] text-white text-xs font-bold px-3 py-1 uppercase tracking-widest mb-4">
                        Ready for Collection
                    </div>

                    <div class="w-full h-40 flex items-center justify-center mb-4 relative overflow-hidden">
                        <div id="reward-glow" class="absolute inset-0 opacity-30 bg-radial-gradient"></div>
                        <img id="reward-img" src="" class="relative z-10 max-h-full max-w-full object-contain filter drop-shadow-[0_0_15px_rgba(255,255,255,0.4)]">
                    </div>

                    <h2 id="reward-name" class="text-4xl font-black italic text-white uppercase tracking-tighter mb-2"></h2>
                    
                    <div class="w-full max-w-md bg-black/40 border border-gray-700 p-4 mt-4">
                        <div class="text-[10px] text-gray-500 uppercase font-bold mb-1 text-left">Recipient ID</div>
                        <input type="text" id="riot-id" value="VAL_PLAYER#NA1" class="w-full bg-transparent text-xl font-bold text-white uppercase outline-none border-b border-gray-700 focus:border-[#ff4655] py-2 transition-colors font-mono">
                    </div>

                    <button onclick="startUpload()" class="mt-6 w-full max-w-md bg-white hover:bg-gray-200 text-black font-black py-4 text-xl uppercase tracking-widest transition-transform active:scale-95 clip-path-polygon">
                        COLLECT
                    </button>
                </div>

                <!-- STAGE 2: UPLOAD -->
                <div id="stage-upload" class="w-full hidden flex-col items-center justify-center py-10">
                    <h3 class="text-2xl font-black text-white italic uppercase mb-2">SYNCING ASSETS</h3>
                    <p id="upload-status" class="text-xs font-mono text-[#ff4655] mb-4">CONNECTING...</p>
                    
                    <div class="w-full max-w-md">
                        <div class="flex justify-between text-[10px] text-gray-500 font-bold mb-1">
                            <span>0%</span>
                            <span>100%</span>
                        </div>
                        <div class="upload-track">
                            <div id="upload-fill" class="upload-fill"></div>
                        </div>
                    </div>
                </div>

                <!-- STAGE 3: SUCCESS -->
                <div id="stage-success" class="w-full hidden flex-col items-center justify-center py-12">
                    <div id="success-box" class="success-box">
                        <span class="checkmark">âœ“</span>
                    </div>
                    <h2 class="text-3xl font-black text-white italic uppercase tracking-widest">CONFIRMED</h2>
                    <p class="text-gray-400 text-xs mt-2 uppercase tracking-[0.2em]">Added to Collection</p>
                </div>

            </div>
        </div>
    </div>

    <script>
        /* --- CONFIGURATION --- */
        const TARGET_COUNT = 3;
        
        const SKINS = [
            { id: 'kuronami', name: 'Kuronami Vandal', url: 'https://static.wikia.nocookie.net/valorant/images/6/63/Kuronami_Vandal_Level_3.png/revision/latest?cb=20240110151228', color: '#38bdf8' },
            { id: 'champions25', name: 'Champions 2025', url: 'https://i.ibb.co/RGmsyfcq/Valorant-Champions-2025-Collection-Vandal-3-removebg-preview.png', color: '#fbbf24' },
            { id: 'mystbloom', name: 'Mystbloom', url: 'https://static.wikia.nocookie.net/valorant/images/0/0b/Mystbloom_Judge.png/revision/latest?cb=20240430173702', color: '#f472b6' },
            { id: 'evori', name: 'Evori Dreamwings', url: 'https://i.ibb.co/VWhdc51g/Snimka-zaslona-2024-07-08-115127-removebg-preview.png', color: '#a78bfa' },
            { id: 'reaver', name: 'Reaver', url: 'https://static.wikia.nocookie.net/valorant/images/2/27/Reaver_Vandal.png/revision/latest?cb=20230711203347', color: '#a855f7' },
            { id: 'elderflame', name: 'Elderflame', url: 'https://static.wikia.nocookie.net/valorant/images/1/1a/Elderflame_Vandal_Blue.png/revision/latest?cb=20230711194256', color: '#ef4444' },
            { id: 'glitchpop', name: 'Glitchpop', url: 'https://static.wikia.nocookie.net/valorant/images/a/ab/Glitchpop_Vandal.png/revision/latest?cb=20230711195022', color: '#22d3ee' },
            { id: 'prime', name: 'Prime', url: 'https://valorantskins.com/img/skins/vandal/prime-vandal-skin.png', color: '#facc15' }
        ];

        /* --- STATE --- */
        let state = {
            active: false,
            mouseX: window.innerWidth / 2,
            inventory: {}, 
            fallingItems: [], 
            lastFrame: 0,
            spawnTimer: 0
        };

        const els = {
            loader: document.getElementById('loader'),
            bar: document.getElementById('loader-progress'),
            txt: document.getElementById('loader-text'),
            btnStart: document.getElementById('btn-start'),
            game: document.getElementById('game-container'),
            crate: document.getElementById('player-crate'),
            invGrid: document.getElementById('inventory-grid'),
            modal: document.getElementById('modal'),
            rewardImg: document.getElementById('reward-img'),
            rewardName: document.getElementById('reward-name'),
            fxLayer: document.getElementById('fx-layer'),
            
            // Modal Stages
            stageConfirm: document.getElementById('stage-confirm'),
            stageUpload: document.getElementById('stage-upload'),
            stageSuccess: document.getElementById('stage-success'),
            uploadFill: document.getElementById('upload-fill'),
            uploadStatus: document.getElementById('upload-status'),
            successBox: document.getElementById('success-box')
        };

        /* --- PRELOADER --- */
        function preload() {
            let loaded = 0;
            const total = SKINS.length + 1; 
            
            const updateProgress = () => {
                loaded++;
                const pct = (loaded / total) * 100;
                els.bar.style.width = `${pct}%`;
                if (loaded === total) {
                    els.txt.textContent = "ASSETS SECURED. READY.";
                    els.btnStart.classList.remove('hidden');
                }
            };
            const crateImg = new Image();
            crateImg.src = "https://i.ibb.co/8gp7yYmP/image-removebg-preview.png";
            crateImg.onload = updateProgress;
            crateImg.onerror = updateProgress;

            SKINS.forEach(skin => {
                const img = new Image();
                img.src = skin.url;
                img.onload = updateProgress;
                img.onerror = updateProgress;
            });
        }
        preload();

        /* --- GAME ENGINE --- */
        function startGame() {
            els.loader.style.display = 'none';
            state.active = true;
            state.lastFrame = performance.now();
            updateInventoryUI();
            requestAnimationFrame(gameLoop);
        }

        window.addEventListener('mousemove', e => state.mouseX = e.clientX);
        window.addEventListener('touchmove', e => {
            state.mouseX = e.touches[0].clientX;
            e.preventDefault();
        }, { passive: false });

        function gameLoop(now) {
            if (!state.active) return;
            const dt = now - state.lastFrame;
            state.lastFrame = now;

            const crateWidth = 140;
            let cx = state.mouseX - (crateWidth / 2);
            cx = Math.max(0, Math.min(window.innerWidth - crateWidth, cx));
            els.crate.style.transform = `translateX(${cx}px)`;

            state.spawnTimer += dt;
            // INCREASED DROP RATE (Spawn every 0.4s instead of 0.8s)
            if (state.spawnTimer > 400) { 
                spawnItem();
                state.spawnTimer = 0;
            }

            updateItems(dt, cx, crateWidth);
            requestAnimationFrame(gameLoop);
        }

        function spawnItem() {
            const data = SKINS[Math.floor(Math.random() * SKINS.length)];
            const div = document.createElement('div');
            div.className = 'skin-object';
            div.innerHTML = `<img src="${data.url}" draggable="false">`;
            
            const x = Math.random() * (window.innerWidth - 130);
            
            els.game.appendChild(div);

            state.fallingItems.push({
                el: div,
                data: data,
                x: x,
                y: -100,
                // INCREASED FALL SPEED
                speed: 0.5 + Math.random() * 0.4, 
                rotation: Math.random() * 360,
                rotSpeed: (Math.random() - 0.5) * 0.3
            });
        }

        function updateItems(dt, crateX, crateW) {
            const floor = window.innerHeight;
            const crateTop = floor - 140;

            for (let i = state.fallingItems.length - 1; i >= 0; i--) {
                const item = state.fallingItems[i];
                item.y += item.speed * dt;
                item.rotation += item.rotSpeed * dt;
                item.el.style.transform = `translate3d(${item.x}px, ${item.y}px, 0) rotate(${item.rotation}deg)`;

                const itemCX = item.x + 65;
                const crateCX = crateX + (crateW / 2);
                
                if (item.y > crateTop && item.y < floor - 20) {
                    if (Math.abs(itemCX - crateCX) < 80) {
                        catchItem(item.data);
                        item.el.remove();
                        state.fallingItems.splice(i, 1);
                        continue;
                    }
                }

                if (item.y > floor) {
                    item.el.remove();
                    state.fallingItems.splice(i, 1);
                }
            }
        }

        function catchItem(skinData) {
            if (!state.inventory[skinData.id]) state.inventory[skinData.id] = 0;
            state.inventory[skinData.id]++;
            
            playHitEffect();
            
            const img = els.crate.querySelector('img');
            img.classList.remove('pop-anim');
            void img.offsetWidth; 
            img.classList.add('pop-anim');

            updateInventoryUI();

            if (state.inventory[skinData.id] >= TARGET_COUNT) {
                triggerWin(skinData);
            }
        }

        function playHitEffect() {
            els.fxLayer.style.opacity = '1';
            setTimeout(() => els.fxLayer.style.opacity = '0', 100);
        }

        function updateInventoryUI() {
            els.invGrid.innerHTML = '';
            const activeIds = Object.keys(state.inventory);
            
            activeIds.forEach(id => {
                const count = state.inventory[id];
                if (count > 0 && count < TARGET_COUNT) {
                    const skin = SKINS.find(s => s.id === id);
                    const row = document.createElement('div');
                    row.className = 'flex items-center gap-2 bg-[#0f1923]/80 p-1 pr-3 rounded-l border-r-4 border-white/10 transition-all slide-in';
                    row.style.borderColor = skin.color;
                    
                    let pips = '';
                    for(let i=0; i<TARGET_COUNT; i++) {
                        pips += `<div class="w-2 h-4 ${i < count ? 'bg-white' : 'bg-gray-700'} skew-x-[-10deg]"></div>`;
                    }

                    row.innerHTML = `
                        <div class="h-8 w-12 flex items-center justify-center overflow-hidden bg-black/30 rounded">
                            <img src="${skin.url}" class="max-h-full max-w-full">
                        </div>
                        <div class="flex flex-col">
                            <span class="text-[10px] font-bold uppercase text-gray-400 leading-none">${skin.name}</span>
                            <div class="flex gap-1 mt-1">${pips}</div>
                        </div>
                    `;
                    els.invGrid.appendChild(row);
                }
            });
        }

        function triggerWin(skin) {
            state.active = false;
            state.inventory[skin.id] = 0;
            updateInventoryUI();

            els.rewardImg.src = skin.url;
            els.rewardName.textContent = skin.name;
            els.rewardName.style.color = skin.color;
            document.getElementById('reward-glow').style.background = `radial-gradient(circle, ${skin.color} 0%, transparent 70%)`;
            
            // RESET MODAL STAGE
            els.stageConfirm.style.display = 'flex';
            els.stageUpload.style.display = 'none';
            els.stageSuccess.style.display = 'none';
            els.successBox.classList.remove('active');
            
            els.modal.classList.remove('hidden');
        }

        window.startUpload = function() {
            // TRANSITION TO UPLOAD STAGE
            els.stageConfirm.style.display = 'none';
            els.stageUpload.style.display = 'flex'; // Use flex to center
            
            let progress = 0;
            els.uploadFill.style.width = '0%';
            
            const interval = setInterval(() => {
                progress += Math.random() * 5;
                if (progress > 100) progress = 100;
                
                els.uploadFill.style.width = `${progress}%`;
                
                // Status Text updates
                if (progress < 30) els.uploadStatus.textContent = "HANDSHAKING PROTOCOL...";
                else if (progress < 70) els.uploadStatus.textContent = `UPLOADING PACKETS: ${Math.floor(progress)}%`;
                else els.uploadStatus.textContent = "FINALIZING TRANSACTION...";

                if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(showSuccess, 500);
                }
            }, 50); // Speed of upload
        }

        function showSuccess() {
            els.stageUpload.style.display = 'none';
            els.stageSuccess.style.display = 'flex';
            
            // Trigger animation frame for CSS transition
            requestAnimationFrame(() => {
                els.successBox.classList.add('active');
            });

            // Close after delay
            setTimeout(() => {
                els.modal.classList.add('hidden');
                
                // Resume
                state.active = true;
                state.lastFrame = performance.now();
                requestAnimationFrame(gameLoop);
            }, 2500);
        }
    </script>
</body>
</html>
